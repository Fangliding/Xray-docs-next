import{r as e,o as l,c as a,a as r,b as n,F as i,d as o,e as t}from"./app.6590e061.js";const h={},s=o('<h1 id="开发规范" tabindex="-1"><a class="header-anchor" href="#开发规范" aria-hidden="true">#</a> 开发规范</h1><h2 id="基本" tabindex="-1"><a class="header-anchor" href="#基本" aria-hidden="true">#</a> 基本</h2><h3 id="版本控制" tabindex="-1"><a class="header-anchor" href="#版本控制" aria-hidden="true">#</a> 版本控制</h3><p>project X 的代码被托管在 github 上:</p>',4),u=t("xray 核心 "),d={href:"https://github.com/XTLS/Xray-core",target:"_blank",rel:"noopener noreferrer"},c=t("xray-core"),p=t("安装脚本 "),g={href:"https://github.com/XTLS/Xray-install",target:"_blank",rel:"noopener noreferrer"},b=t("Xray-install"),m=t("配置模板 "),f={href:"https://github.com/XTLS/Xray-examples",target:"_blank",rel:"noopener noreferrer"},x=t("Xray-examples"),y=t("xray 文档 "),X={href:"https://github.com/XTLS/Xray-docs-next",target:"_blank",rel:"noopener noreferrer"},k=t("Xray-docs-next"),_=t("您可以使用 "),P={href:"https://git-scm.com/",target:"_blank",rel:"noopener noreferrer"},v=t("Git"),G=t(" 来获取代码。"),R=r("h3",{id:"分支-branch",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#分支-branch","aria-hidden":"true"},"#"),t(" 分支（Branch）")],-1),B=r("ul",null,[r("li",null,"本项目的主干分支为 main，"),r("li",null,"本项目的发布主分支同为 main，"),r("li",null,"需要确保 main 在任一时刻都是可编译，且可正常使用的。"),r("li",null,"如果需要开发新的功能，请新建分支进行开发，在开发完成并且经过充分测试后，合并回主干分支。"),r("li",null,"已经合并入主干且没有必要存在的分支，请删除。")],-1),E=r("h3",{id:"发布-release",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#发布-release","aria-hidden":"true"},"#"),t(" 发布（Release）")],-1),L=r("ul",null,[r("li",null,[t("建立尝鲜版本和稳定版本两个发布通道 "),r("ul",null,[r("li",null,"尝鲜版本，可以为 daily build，主要用于特定情况的测试，尝鲜和获得即时反馈和再改进。"),r("li",null,"稳定版本，为定时更新(比如月更)，合并稳定的修改并发布。")])])],-1),T=r("h3",{id:"引用其它项目",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#引用其它项目","aria-hidden":"true"},"#"),t(" 引用其它项目")],-1),q=t("Golang "),A=t("产品代码建议使用 Golang 标准库和 "),F={href:"https://pkg.go.dev/search?q=golang.org%2Fx",target:"_blank",rel:"noopener noreferrer"},S=t("golang.org/x/"),w=t(" 下的库；"),C=r("li",null,"如需引用其它项目，请事先创建 issue 讨论；",-1),H=r("li",null,[t("其它 "),r("ul",null,[r("li",null,"不违反双方的协议，且对项目有帮助的工具，都可以使用。")])],-1),j=r("h2",{id:"开发流程",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#开发流程","aria-hidden":"true"},"#"),t(" 开发流程")],-1),M=r("h3",{id:"写代码之前",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#写代码之前","aria-hidden":"true"},"#"),t(" 写代码之前")],-1),z=t("发现任何问题，或对项目有任何想法，请创建 "),D={href:"https://github.com/XTLS/Xray-core/issues",target:"_blank",rel:"noopener noreferrer"},I=t("issue"),O=t(" 讨论以减少重复劳动和消耗在代码上的时间。"),W=r("h3",{id:"修改代码",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#修改代码","aria-hidden":"true"},"#"),t(" 修改代码")],-1),J=t("Golang "),K=t("请参考 "),N={href:"https://golang.org/doc/effective_go.html",target:"_blank",rel:"noopener noreferrer"},Q=t("Effective Go"),U=t("；"),V=r("li",null,[t("每一次 push 之前，请运行："),r("code",null,"go generate core/format.go"),t("；")],-1),Y=r("li",null,[t("如果需要修改 protobuf，例如增加新配置项，请运行："),r("code",null,"go generate core/proto.go"),t("；")],-1),Z=r("li",null,[t("提交 pull request 之前，建议测试通过："),r("code",null,"go test ./..."),t("；")],-1),$=r("li",null,"提交 pull request 之前，建议新增代码有超过 70% 的代码覆盖率（code coverage）；",-1),ee=r("li",null,[t("其它 "),r("ul",null,[r("li",null,"请注意代码的可读性。")])],-1),le=o('<h3 id="pull-request" tabindex="-1"><a class="header-anchor" href="#pull-request" aria-hidden="true">#</a> Pull Request</h3><ul><li>提交 PR 之前，请先运行 <code>git pull https://github.com/xray/xray-core.git</code> 以确保 merge 可顺利进行；</li><li>一个 PR 只做一件事，如有对多个 bug 的修复，请对每一个 bug 提交一个 PR；</li><li>由于 Golang 的特殊需求（Package path），Go 项目的 PR 流程和其它项目有所不同，建议流程如下： <ol><li>先 Fork 本项目，创建你自己的 <code>github.com/&lt;your_name&gt;/Xray-core.git</code> 仓库；</li><li>克隆你自己的 Xray 仓库到本地：<code>git clone https://github.com/&lt;your_name&gt;/Xray-core.git</code>；</li><li>基于 <code>main</code> 分支创建新的分支，例如 <code>git branch issue24 main</code>；</li><li>在新创建的分支上作修改并提交修改(commit)；</li><li>在推送(push)修改完成的分支到自己的仓库前，先切换到 <code>main</code> 分支，运行 <code>git pull https://github.com/xray/xray-core.git</code> 拉取最新的远端代码；</li><li>如果上一步拉取得到了新的远端代码，则切换到之前自己创建的分支，运行 <code>git rebase main</code> 执行分支合并操作。如遇到文件冲突，则需要解决冲突；</li><li>上一步处理完毕后，就可以把自己创建的分支推送到自己的仓库：<code>git push -u origin your-branch</code></li><li>最后，把自己仓库的新推送的分支往 <code>xtls/Xray-core</code> 的 <code>main</code> 分支发 PR 即可；</li><li>请在 PR 的标题和正文中，完整表述此次 PR 解决的问题 / 新增的功能 / 代码所做的修改的用意等；</li><li>耐心等待开发者的回应。</li></ol></li></ul><h3 id="对代码的修改" tabindex="-1"><a class="header-anchor" href="#对代码的修改" aria-hidden="true">#</a> 对代码的修改</h3><h4 id="功能性问题" tabindex="-1"><a class="header-anchor" href="#功能性问题" aria-hidden="true">#</a> 功能性问题</h4><p>请提交至少一个测试用例（Test Case）来验证对现有功能的改动。</p><h4 id="性能相关" tabindex="-1"><a class="header-anchor" href="#性能相关" aria-hidden="true">#</a> 性能相关</h4><p>请提交必要的测试数据来证明现有代码的性能缺陷，或是新增代码的性能提升。</p><h4 id="新功能" tabindex="-1"><a class="header-anchor" href="#新功能" aria-hidden="true">#</a> 新功能</h4><ul><li>如果新增功能对已有功能不影响，请提供可以开启/关闭的开关（如 flag），并使新功能保持默认关闭的状态；</li><li>大型新功能（比如增加一个新的协议）开发之前，请先提交一个 issue，讨论完毕之后再进行开发。</li></ul><h4 id="其它" tabindex="-1"><a class="header-anchor" href="#其它" aria-hidden="true">#</a> 其它</h4><p>视具体情况而定。</p><h2 id="xray-编码规范" tabindex="-1"><a class="header-anchor" href="#xray-编码规范" aria-hidden="true">#</a> Xray 编码规范</h2><p>以下内容适用于 Xray 中的 Golang 代码。</p><h3 id="代码结构" tabindex="-1"><a class="header-anchor" href="#代码结构" aria-hidden="true">#</a> 代码结构</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Xray-core\n├── app        // 应用模块\n│   ├── router // 路由\n├── common     // 公用代码\n├── proxy      // 通讯协议\n│   ├── blackhole\n│   ├── dokodemo-door\n│   ├── freedom\n│   ├── socks\n│   ├── vmess\n├── transport  // 传输模块\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="编码规范" tabindex="-1"><a class="header-anchor" href="#编码规范" aria-hidden="true">#</a> 编码规范</h3><p>基本与 Golang 官方所推荐做法一致，有一些例外。写在这里以方便大家熟悉 Golang。</p><h4 id="命名" tabindex="-1"><a class="header-anchor" href="#命名" aria-hidden="true">#</a> 命名</h4>',18),ae=r("li",null,[t("文件和目录名尽量使用单个英文单词，比如 hello.go； "),r("ul",null,[r("li",null,"如果实在没办法，则目录使用连接线／文件名使用下划线连接两个（或多个单词），比如 hello-world/hello_again.go；"),r("li",null,"测试代码使用 _test.go 结尾；")])],-1),re=r("li",null,[t("类型使用 Pascal 命名法，比如 ConnectionHandler； "),r("ul",null,[r("li",null,"对缩写不强制小写，即 HTML 不必写成 Html；")])],-1),ne=r("li",null,"公开成员变量也使用 Pascal 命名法；",-1),ie=t("私有成员变量使用 "),oe={href:"https://zh.wikipedia.org/wiki/%E9%A7%9D%E5%B3%B0%E5%BC%8F%E5%A4%A7%E5%B0%8F%E5%AF%AB",target:"_blank",rel:"noopener noreferrer"},te=t("小驼峰式命名法"),he=t(" ，如 "),se=r("code",null,"privateAttribute",-1),ue=t(" ；"),de=r("li",null,[t("为了方便重构，方法建议全部使用 Pascal 命名法； "),r("ul",null,[r("li",null,[t("完全私有的类型放入 "),r("code",null,"internal"),t(" 。")])])],-1),ce=r("h4",{id:"内容组织",tabindex:"-1"},[r("a",{class:"header-anchor",href:"#内容组织","aria-hidden":"true"},"#"),t(" 内容组织")],-1),pe=r("ul",null,[r("li",null,"一个文件包含一个主要类型，及其相关的私有函数等；"),r("li",null,"测试相关的文件，如 Mock 等工具类，放入 testing 子目录。")],-1);h.render=function(o,t){const h=e("OutboundLink"),ge=e("Badge");return l(),a(i,null,[s,r("ul",null,[r("li",null,[u,r("a",d,[c,n(h)])]),r("li",null,[p,r("a",g,[b,n(h)])]),r("li",null,[m,r("a",f,[x,n(h)])]),r("li",null,[y,r("a",X,[k,n(h)])])]),r("p",null,[_,r("a",P,[v,n(h)]),G]),R,B,E,n(ge,{text:"WIP",type:"warning"}),L,T,r("ul",null,[r("li",null,[q,r("ul",null,[r("li",null,[A,r("a",F,[S,n(h)]),w]),C])]),H]),j,M,r("p",null,[z,r("a",D,[I,n(h)]),O]),W,r("ul",null,[r("li",null,[J,r("ul",null,[r("li",null,[K,r("a",N,[Q,n(h)]),U]),V,Y,Z,$])]),ee]),le,r("ul",null,[ae,re,ne,r("li",null,[ie,r("a",oe,[te,n(h)]),he,se,ue]),de]),ce,pe],64)};export default h;
