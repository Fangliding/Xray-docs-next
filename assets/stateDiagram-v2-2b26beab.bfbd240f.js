import{p as e,d as t,s,D as a,a as o,S as r,b as i,c as n}from"./styles-9c745c82.b4f936dc.js";import{G as d}from"./layout.fecf0520.js";import{l as c,c as l,h as p,y as b,i as g,j as f}from"./mermaid.core.cc57480f.js";import{r as h}from"./index-2c4b9a3b.099f9bd6.js";import"./app.5501c5b8.js";import"./edges-f2ad444c.0c0fb25d.js";import"./createText-62fc7601.535bec5e.js";import"./line.3dbfe66b.js";import"./array.ca8349ae.js";import"./constant.f07fca73.js";let y={},m=0;function u(e="",t=0,s="",a="----"){return`state-${e}${null!==s&&s.length>0?`${a}${s}`:""}-${t}`}const x=(e,t,s,r,i,n)=>{const d=s.id,p=null==(b=r[d])?"":b.classes?b.classes.join(" "):"";var b;if("root"!==d){let t="rect";!0===s.start&&(t="start"),!1===s.start&&(t="end"),s.type!==a&&(t=s.type),y[d]||(y[d]={id:d,shape:t,description:f.sanitizeText(d,l()),classes:`${p} statediagram-state`});const r=y[d];s.description&&(Array.isArray(r.description)?(r.shape="rectWithTitle",r.description.push(s.description)):r.description.length>0?(r.shape="rectWithTitle",r.description===d?r.description=[s.description]:r.description=[r.description,s.description]):(r.shape="rect",r.description=s.description),r.description=f.sanitizeTextOrArray(r.description,l())),1===r.description.length&&"rectWithTitle"===r.shape&&(r.shape="rect"),!r.type&&s.doc&&(c.info("Setting cluster for ",d,T(s)),r.type="group",r.dir=T(s),r.shape=s.type===o?"divider":"roundedWithTitle",r.classes=r.classes+" statediagram-cluster "+(n?"statediagram-cluster-alt":""));const i={labelStyle:"",shape:r.shape,labelText:r.description,classes:r.classes,style:"",id:d,dir:r.dir,domId:u(d,m),type:r.type,padding:15,centerLabel:!0};if(s.note){const t={labelStyle:"",shape:"note",labelText:s.note.text,classes:"statediagram-note",style:"",id:d+"----note-"+m,domId:u(d,m,"note"),type:r.type,padding:15},a={labelStyle:"",shape:"noteGroup",labelText:s.note.text,classes:r.classes,style:"",id:d+"----parent",domId:u(d,m,"parent"),type:"group",padding:0};m++;const o=d+"----parent";e.setNode(o,a),e.setNode(t.id,t),e.setNode(d,i),e.setParent(d,o),e.setParent(t.id,o);let n=d,c=t.id;"left of"===s.note.position&&(n=t.id,c=d),e.setEdge(n,c,{arrowhead:"none",arrowType:"",style:"fill:none",labelStyle:"",classes:"transition note-edge",arrowheadStyle:"fill: #333",labelpos:"c",labelType:"text",thickness:"normal"})}else e.setNode(d,i)}t&&"root"!==t.id&&(c.trace("Setting node ",d," to be child of its parent ",t.id),e.setParent(d,t.id)),s.doc&&(c.trace("Adding nodes children "),w(e,s,s.doc,r,i,!n))},w=(e,t,s,o,n,d)=>{c.trace("items",s),s.forEach((s=>{switch(s.stmt){case i:case a:x(e,t,s,o,n,d);break;case r:{x(e,t,s.state1,o,n,d),x(e,t,s.state2,o,n,d);const a={id:"edge"+m,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:"fill:none",labelStyle:"",label:f.sanitizeText(s.description,l()),arrowheadStyle:"fill: #333",labelpos:"c",labelType:"text",thickness:"normal",classes:"transition"};e.setEdge(s.state1.id,s.state2.id,a,m),m++}}}))},T=(e,t=n)=>{let s=t;if(e.doc)for(let a=0;a<e.doc.length;a++){const t=e.doc[a];"dir"===t.stmt&&(s=t.value)}return s},S={parser:e,db:t,renderer:{setConf:function(e){const t=Object.keys(e);for(const s of t)e[s]},getClasses:function(e,t){return t.db.extract(t.db.getRootDocV2()),t.db.getClasses()},draw:async function(e,t,s,a){c.info("Drawing state diagram (v2)",t),y={},a.db.getDirection();const{securityLevel:o,state:r}=l(),i=r.nodeSpacing||50,n=r.rankSpacing||50;c.info(a.db.getRootDocV2()),a.db.extract(a.db.getRootDocV2()),c.info(a.db.getRootDocV2());const f=a.db.getStates(),m=new d({multigraph:!0,compound:!0}).setGraph({rankdir:T(a.db.getRootDocV2()),nodesep:i,ranksep:n,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let u;x(m,void 0,a.db.getRootDocV2(),f,a.db,!0),"sandbox"===o&&(u=p("#i"+t));const w=p("sandbox"===o?u.nodes()[0].contentDocument.body:"body"),S=w.select(`[id="${t}"]`),j=w.select("#"+t+" g");await h(j,m,["barb"],"statediagram",t);b.insertTitle(S,"statediagramTitleText",r.titleTopMargin,a.db.getDiagramTitle());const D=S.node().getBBox(),$=D.width+16,A=D.height+16;S.attr("class","statediagram");const k=S.node().getBBox();g(S,A,$,r.useMaxWidth);const v=`${k.x-8} ${k.y-8} ${$} ${A}`;c.debug(`viewBox ${v}`),S.attr("viewBox",v);const B=document.querySelectorAll('[id="'+t+'"] .edgeLabel .label');for(const d of B){const e=d.getBBox(),t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("rx",0),t.setAttribute("ry",0),t.setAttribute("width",e.width),t.setAttribute("height",e.height),d.insertBefore(t,d.firstChild)}}},styles:s,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,t.clear()}};export{S as diagram};
